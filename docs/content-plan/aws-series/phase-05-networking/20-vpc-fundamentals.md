# Part 20: VPC ‚Äî Networking Fundamentals

> Status: PLANNED
> Blog file: `apps/web/src/content/blog/aws-for-startups/20-vpc-fundamentals.mdx`
> Estimated word count: 3,000-3,500

## Frontmatter

```yaml
---
title: "VPC Fundamentals: The Network Your Backend Lives In"
description: "Build a production VPC with public and private subnets, NAT gateway, and VPC endpoints. The networking foundation for everything from EC2 to ECS to Lambda."
excerpt: "The network your backend lives in. Production VPC with public and private subnets ‚Äî because your database should never be one click away from the internet."
date: "2026-03-24"
author: "works-on-my.cloud"
tags: ["aws", "devops", "startup", "vpc", "networking", "terraform"]
series: "AWS From Zero to Production"
seriesPart: 20
featured: false
draft: true
---
```

## Component Imports

```mdx
import GuideStep from '../../../components/shared/GuideStep.astro';
import Command from '../../../components/shared/Command.astro';
import TerminalOutput from '../../../components/shared/TerminalOutput.astro';
import Alert from '../../../components/shared/Alert.astro';
import ValidationChecklist from '../../../components/shared/ValidationChecklist.astro';
import FileTree from '../../../components/shared/FileTree.astro';
import ResourceStatus from '../../../components/shared/ResourceStatus.astro';
```

## Opening Hook

Your database has a public IP. Right now, the only thing between it and every port scanner on the internet is a security group. One misconfigured rule and your data is exposed. VPC private subnets fix this architecturally ‚Äî your database literally cannot be reached from the internet, regardless of security group rules.

Time promise: 50 minutes.
Outcome promise: Production VPC with public subnets (ALB, NAT), private subnets (EC2, ECS, RDS), VPC endpoints for S3/DynamoDB, and CIDR blocks documented.

## Section Outline

### 1. Why This Matters
- The "database with a public IP" horror story
- Network architecture as defense in depth
- ASCII diagram: VPC with public/private subnets, NAT, internet gateway

### 2. VPC Design
- CIDR block planning (/16 VPC, /24 subnets)
- Multi-AZ layout (2 AZs minimum)
- Public vs private subnet designation
- Components: Alert (important) with comprehensive VPC architecture diagram

### 3. Internet Gateway + NAT Gateway
- Internet gateway for public subnets
- NAT gateway for private subnet internet access (outbound only)
- NAT cost awareness ($32/month minimum)

### 4. VPC Endpoints
- Gateway endpoints for S3 and DynamoDB (free, save NAT costs)
- Interface endpoints for other services
- Components: ComparisonTable (NAT vs VPC endpoint cost)

### 5. Route Tables
- Public route table (0.0.0.0/0 ‚Üí Internet Gateway)
- Private route table (0.0.0.0/0 ‚Üí NAT Gateway, S3/DynamoDB ‚Üí VPC Endpoint)

### 6. Agent-Assisted Terraform
- Full VPC module generated by agent
- Review focus: subnet placement, CIDR conflicts, missing VPC endpoints

### 7. AGENT-INSTRUCTIONS.md Addition
- Networking section (5 lines)

## The Fine Line

| | |
|---|---|
| ‚ùå Under | Default VPC, everything in public subnets, no VPC endpoints |
| ‚úÖ Right | Custom VPC, public/private subnets, NAT gateway, VPC endpoints for S3/DynamoDB |
| ‚ùå Over | Transit Gateway, multiple VPCs, VPN connections, for a single-region application |
| ü§ñ Agent Trap | Agent puts RDS in public subnet ("for easier access") and forgets VPC endpoints ($100+/mo in NAT costs) |

## Agent Trap

The most expensive agent networking mistake: no VPC endpoints. Without S3 and DynamoDB VPC endpoints, all traffic to these services routes through the NAT gateway at $0.045/GB. For a typical application doing moderate S3/DynamoDB operations, this adds $100-200/month in unnecessary NAT charges. Agents never create VPC endpoints unprompted.

Second trap: agents put databases in public subnets because it eliminates connection issues during development. The AGENT-INSTRUCTIONS.md rule now explicitly forbids this.

## Thread Progression

- **AGENT-INSTRUCTIONS.md:** Networking section added (5 lines: no public databases, no 0.0.0.0/0 except ALB 443, VPC endpoints required, CIDR documented). Cumulative: 48 lines.
- **Scorecard:** No new panels
- **Eval:** No changes
- **MCP:** No changes

## Validation Checklist Items

- **VPC:** Custom VPC created with documented CIDR; Public and private subnets in 2+ AZs; Internet gateway attached; NAT gateway in public subnet; Route tables configured correctly
- **VPC Endpoints:** S3 gateway endpoint created; DynamoDB gateway endpoint created
- **Security:** No database subnets have internet gateway routes; Private subnets only route to NAT gateway
- **AGENT-INSTRUCTIONS.md:** Networking section added (5 rules)

## Key Takeaways

1. Private subnets are architectural security ‚Äî your database can't be reached from the internet regardless of security group rules.
2. VPC endpoints for S3 and DynamoDB are free and save $100+/month in NAT charges ‚Äî agents never create them unprompted.
3. Document your CIDR blocks in AGENT-INSTRUCTIONS.md before agents can reference them ‚Äî prevents CIDR conflicts and overlapping ranges.
4. Everything from Phase 7 onward lives in this VPC. Get the foundation right now.

## Lead Magnet

- **Name:** VPC Reference Architecture
- **Format:** PDF + Terraform module
- **Contents:** Production VPC Terraform module, CIDR planning worksheet, VPC endpoint configuration, cost comparison (NAT vs VPC endpoints).

## ASCII Diagrams Spec

1. **VPC Architecture** ‚Äî Placement: Why This Matters + VPC Design. Comprehensive diagram showing: VPC boundary, 2 AZs, public subnets (ALB, NAT), private subnets (EC2/ECS, RDS), internet gateway, NAT gateway, VPC endpoints, route tables.
