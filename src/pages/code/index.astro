---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import Container from '../../components/layout/Container.astro';
import ScriptCard from '../../components/code/ScriptCard.astro';
import CodeFilterBar from '../../components/code/CodeFilterBar.astro';

const scripts = await getCollection('scripts');
---

<Layout title="Code Library | works-on-my.cloud" description="Bash scripts, Terraform modules, and infrastructure code">
  <div class="min-h-screen flex flex-col">
    <Header />
    <main id="main-content" class="flex-1">
      <Container class="py-12">
        <h1 class="mb-4">Code Library</h1>
        <p class="text-fg-secondary text-lg mb-8">
          Bash scripts, Terraform modules, and infrastructure code
        </p>
        <CodeFilterBar />
        <div id="code-list-container" class="space-y-6">
          {scripts.map((script) => (
            <div
              data-script-card
              data-title={script.data.title}
              data-description={script.data.description}
              data-tags={JSON.stringify(script.data.tags)}
              data-language={script.data.language}
            >
              <ScriptCard
                title={script.data.title}
                description={script.data.description}
                tags={script.data.tags}
                language={script.data.language}
                slug={script.slug}
                externalRepo={script.data.externalRepo}
              />
            </div>
          ))}
        </div>
        <div id="code-empty-state" class="hidden text-center py-12">
          <p class="text-fg-secondary text-lg mb-4">No scripts found matching your filters.</p>
          <button
            id="code-clear-filters-empty"
            class="text-accent-blue hover:text-accent-cyan transition-colors underline"
          >
            Clear all filters
          </button>
        </div>
      </Container>
    </main>
    <Footer />
  </div>
</Layout>

