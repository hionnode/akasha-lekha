---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import Container from '../../components/layout/Container.astro';
import PostList from '../../components/blog/PostList.astro';
import FilterBar from '../../components/blog/FilterBar.astro';
import VimShortcuts from '../../components/shared/VimShortcuts.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<Layout title="Blog | works-on-my.cloud" description="Technical articles about cloud infrastructure, DevOps, security, and observability">
  <div class="min-h-screen flex flex-col">
    <Header />
    <main id="main-content" class="flex-1">
      <Container class="py-12">
        <h1 class="mb-8">Blog</h1>
        <FilterBar />
        <div id="blog-content">
          <PostList posts={posts} />
        </div>
        <div id="empty-state" class="hidden text-center py-12">
          <p class="text-fg-secondary text-lg mb-4">ğŸ” No posts found matching your filters.</p>
          <button
            id="clear-filters-empty"
            class="px-4 py-2 text-accent-blue hover:text-accent-cyan hover:bg-accent-blue/10 transition-colors underline rounded"
          >
            Clear all filters
          </button>
        </div>
      </Container>
    </main>
    <Footer />
    <VimShortcuts />
  </div>
</Layout>

<script>
  // No longer needed - content renders immediately on static site
  document.addEventListener('astro:page-load', () => {
    // Ensure content is visible
    const content = document.getElementById('blog-content');
    if (content) {
      content.classList.remove('hidden');
    }
  });
</script>
