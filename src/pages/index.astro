---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';
import Container from '../components/layout/Container.astro';
import PostList from '../components/blog/PostList.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const featuredPosts = allPosts
  .filter((post) => post.data.featured)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 5);

const latestPosts = allPosts
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 5);
---

<Layout title="works-on-my.cloud">
  <div class="min-h-screen flex flex-col">
    <Header />
    <main class="flex-1">
      <Container class="py-12">
        <section class="mb-16">
          <h1 class="mb-4">works-on-my.cloud</h1>
          <p class="text-fg-secondary text-lg">
            A developer-focused technical blog and code library showcasing cloud infrastructure,
            DevOps, security, and observability content.
          </p>
        </section>

        {featuredPosts.length > 0 && (
          <section class="mb-12">
            <h2 class="mb-6">Featured</h2>
            <PostList posts={featuredPosts} />
          </section>
        )}

        <section>
          <h2 class="mb-6">Latest</h2>
          <PostList posts={latestPosts} />
        </section>
      </Container>
    </main>
    <Footer />
  </div>
</Layout>
