---

---

<div
  id="global-loader"
  class="fixed inset-0 bg-bg-primary z-[9999] flex items-center justify-center transition-opacity duration-700 ease-out"
>
  <!-- Animated background gradient -->
  <div
    class="absolute inset-0 bg-gradient-to-br from-bg-primary via-bg-secondary to-bg-tertiary opacity-50"
  >
  </div>

  <!-- Main content -->
  <div class="relative z-10 text-center px-4">
    <!-- Large penguin ASCII art with animation -->
    <div class="mb-8">
      <pre
        class="text-accent-cyan text-2xl sm:text-3xl md:text-4xl leading-[1.2] font-mono loader-penguin whitespace-pre"
        id="penguin-art">
      </pre>
    </div>

    <!-- Loading text with typing animation -->
    <div class="space-y-3">
      <div
        class="text-fg-primary text-xl sm:text-2xl font-semibold font-mono loader-text"
        id="loading-text"
      >
        <span class="inline-block">L</span><span class="inline-block">o</span><span
          class="inline-block">a</span
        ><span class="inline-block">d</span><span class="inline-block">i</span><span
          class="inline-block">n</span
        ><span class="inline-block">g</span><span class="inline-block loader-dots">...</span>
      </div>
      <div class="text-fg-muted text-sm sm:text-base font-mono">works-on-my.cloud</div>
    </div>

    <!-- Progress indicator -->
    <div class="mt-8 w-64 mx-auto">
      <div class="h-1 bg-bg-tertiary rounded-full overflow-hidden">
        <div
          class="h-full bg-gradient-to-r from-accent-blue via-accent-cyan to-accent-blue loader-progress"
        >
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Enhanced large Linux penguin (Tux) ASCII art - detailed version from ascii-art.de
  const penguin = `
              a8888b.
             d888888b.
             8P"YP"Y88
             8|o||o|88
             8'    .88
             8\`._.' Y8.
            d/      \`8b.
           dP   .    Y8b.
          d8:'  "  \`::88b
         d8"         'Y88b
        :8P    '      :888
         8a.   :     _a88P
       ._/"Yaa_:   .| 88P|
       \\    YP"    \`| 8P  \`.
      /     \\.___.d|    .'
       \`--..__)8888P\`._.'
  `;

  const penguinArt = document.getElementById('penguin-art');
  if (penguinArt) {
    penguinArt.textContent = penguin;
  }

  // Animate loading text characters
  function animateLoadingText() {
    const textElement = document.getElementById('loading-text');
    if (!textElement) return;

    const spans = textElement.querySelectorAll('span:not(.loader-dots)');
    spans.forEach((span, index) => {
      setTimeout(() => {
        const htmlSpan = span as HTMLElement;
        htmlSpan.style.opacity = '1';
        htmlSpan.style.transform = 'translateY(0)';
      }, index * 100);
    });
  }

  // Animate progress bar
  function animateProgress() {
    const progressBar = document.querySelector('.loader-progress') as HTMLElement | null;
    if (progressBar) {
      let width = 0;
      const interval = setInterval(() => {
        width += Math.random() * 15;
        if (width >= 100) {
          width = 100;
          clearInterval(interval);
        }
        progressBar.style.width = `${width}%`;
      }, 100);
    }
  }

  // Hide loader when page is ready
  function hideLoader() {
    const loader = document.getElementById('global-loader');
    if (loader) {
      loader.style.opacity = '0';
      loader.style.transform = 'scale(0.95)';
      setTimeout(() => {
        loader.style.display = 'none';
      }, 700);
    }
  }

  // Track if this is the initial page load
  let isInitialLoad = true;
  const loaderStartTime = Date.now();

  // Hide loader on initial page load only
  function handleInitialLoad() {
    if (isInitialLoad) {
      isInitialLoad = false;

      // Calculate how long the loader has been visible
      const elapsedTime = Date.now() - loaderStartTime;
      const minimumDisplayTime = 400; // Minimum 400ms to see the animation
      const remainingTime = Math.max(0, minimumDisplayTime - elapsedTime);

      // Animate progress to completion
      const progressBar = document.querySelector('.loader-progress') as HTMLElement | null;
      if (progressBar) {
        progressBar.style.width = '100%';
      }

      // Wait for remaining time before hiding
      setTimeout(hideLoader, remainingTime + 500);
    }
  }

  // Initialize animations
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      animateLoadingText();
      animateProgress();
    });
  } else {
    animateLoadingText();
    animateProgress();
  }

  if (document.readyState === 'complete') {
    handleInitialLoad();
  } else {
    window.addEventListener('load', handleInitialLoad);
  }

  // Do NOT show loader on client-side navigation
  // Astro View Transitions make navigation instant, so loader is unnecessary
</script>

<style>
  #global-loader {
    font-family: 'Inconsolata', monospace;
    backdrop-filter: blur(8px);
  }

  .loader-penguin {
    animation: penguinFloat 3s ease-in-out infinite;
    text-shadow: 0 0 20px rgba(125, 207, 255, 0.3);
    filter: drop-shadow(0 0 10px rgba(125, 207, 255, 0.2));
  }

  .loader-text span:not(.loader-dots) {
    opacity: 0;
    transform: translateY(-10px);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  .loader-dots {
    animation: dotsPulse 1.5s ease-in-out infinite;
  }

  .loader-dots::after {
    content: '...';
    animation: dotsBlink 1.5s steps(4, end) infinite;
  }

  .loader-progress {
    width: 0%;
    transition: width 0.3s ease;
    background-size: 200% 100%;
    animation: progressShimmer 2s linear infinite;
  }

  @keyframes penguinFloat {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  @keyframes dotsPulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.3;
    }
  }

  @keyframes dotsBlink {
    0%,
    20% {
      content: '.';
    }
    40% {
      content: '..';
    }
    60%,
    100% {
      content: '...';
    }
  }

  @keyframes progressShimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* Smooth entrance animation */
  #global-loader {
    animation: loaderFadeIn 0.5s ease-out;
  }

  @keyframes loaderFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>
