---
interface Props {
  series: string;
  seriesPart: number;
  seriesTotal: number;
  allPosts: Array<{
    slug: string;
    data: {
      title: string;
      series?: string;
      seriesPart?: number;
    };
  }>;
}

const { series, seriesPart, seriesTotal, allPosts } = Astro.props;

// Get all posts in this series, sorted by part number
const seriesPosts = allPosts
  .filter(post => post.data.series === series && post.data.seriesPart)
  .sort((a, b) => (a.data.seriesPart || 0) - (b.data.seriesPart || 0));

const currentIndex = seriesPosts.findIndex(post => post.data.seriesPart === seriesPart);
const previousPost = currentIndex > 0 ? seriesPosts[currentIndex - 1] : null;
const nextPost = currentIndex < seriesPosts.length - 1 ? seriesPosts[currentIndex + 1] : null;
---

<nav class="border border-accent-blue bg-bg-secondary/50 backdrop-blur-sm rounded-lg p-5 mb-8">
  <div class="flex items-center justify-between mb-4">
    <h4 class="text-sm font-semibold uppercase tracking-wider text-accent-blue flex items-center gap-2">
      <span class="text-accent-cyan">ğŸ“š</span>
      Series Navigation
    </h4>
    <span class="text-xs text-fg-muted">
      Part {seriesPart} of {seriesTotal}
    </span>
  </div>

  <!-- Progress bar -->
  <div class="mb-4">
    <div class="h-1 bg-bg-tertiary rounded-full overflow-hidden">
      <div 
        class="h-full bg-gradient-to-r from-accent-blue to-accent-cyan transition-all duration-300"
        style={`width: ${(seriesPart / seriesTotal) * 100}%`}
      />
    </div>
  </div>

  <!-- All parts list -->
  <ol class="space-y-2 mb-4">
    {seriesPosts.map((post) => {
      const isCurrent = post.data.seriesPart === seriesPart;
      const isCompleted = (post.data.seriesPart || 0) < seriesPart;
      
      return (
        <li>
          <a
            href={`/blog/${post.slug}`}
            class={`block px-4 py-2.5 rounded transition-all ${
              isCurrent
                ? 'bg-accent-blue/20 text-accent-blue border border-accent-blue shadow-sm'
                : isCompleted
                ? 'text-fg-secondary hover:bg-bg-tertiary hover:text-fg-primary border border-transparent'
                : 'text-fg-muted hover:bg-bg-tertiary hover:text-fg-secondary border border-transparent'
            }`}
          >
            <div class="flex items-center gap-3">
              <span class={`text-sm font-mono ${isCurrent ? 'text-accent-blue' : 'text-fg-muted'}`}>
                {isCompleted ? 'âœ“' : post.data.seriesPart}.
              </span>
              <span class="text-sm flex-1">
                {post.data.title.replace(/^.*?Part \d+:\s*/, '')}
              </span>
              {isCurrent && (
                <span class="text-xs px-2 py-0.5 bg-accent-blue text-bg-primary rounded-full">
                  Current
                </span>
              )}
            </div>
          </a>
        </li>
      );
    })}
  </ol>

  <!-- Previous/Next navigation -->
  <div class="grid grid-cols-2 gap-3 pt-4 border-t border-border">
    {previousPost ? (
      <a
        href={`/blog/${previousPost.slug}`}
        class="flex items-center gap-2 px-3 py-2 text-sm text-fg-secondary hover:text-accent-blue transition-colors group"
      >
        <span class="text-accent-blue group-hover:translate-x-[-4px] transition-transform">â†</span>
        <div class="flex-1 min-w-0">
          <div class="text-xs text-fg-muted uppercase tracking-wide">Previous</div>
          <div class="truncate">Part {previousPost.data.seriesPart}</div>
        </div>
      </a>
    ) : (
      <div class="px-3 py-2 text-sm text-fg-muted/50">
        â† First part
      </div>
    )}
    
    {nextPost ? (
      <a
        href={`/blog/${nextPost.slug}`}
        class="flex items-center gap-2 px-3 py-2 text-sm text-fg-secondary hover:text-accent-blue transition-colors group text-right"
      >
        <div class="flex-1 min-w-0">
          <div class="text-xs text-fg-muted uppercase tracking-wide">Next</div>
          <div class="truncate">Part {nextPost.data.seriesPart}</div>
        </div>
        <span class="text-accent-blue group-hover:translate-x-[4px] transition-transform">â†’</span>
      </a>
    ) : (
      <div class="px-3 py-2 text-sm text-fg-muted/50 text-right">
        Last part â†’
      </div>
    )}
  </div>
</nav>

